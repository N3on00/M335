<mxfile host="app.diagrams.net" modified="2026-02-17T00:00:00.000Z" agent="OpenCode" version="24.7.17">
  <diagram id="backend-generic-architecture" name="Backend Generic Architecture">
    <mxGraphModel dx="1800" dy="1000" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1800" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <mxCell id="10" value="Backend Architecture (Generic-First)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8f9fa;strokeColor=#b0b0b0;dashed=1;fontStyle=1;align=left;verticalAlign=top;spacingLeft=8;spacingTop=6;" vertex="1" parent="1">
          <mxGeometry x="20" y="20" width="1740" height="1040" as="geometry" />
        </mxCell>

        <mxCell id="11" value="Composition Root" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f0fe;strokeColor=#6c8ebf;fontStyle=1;align=left;verticalAlign=top;spacingLeft=8;spacingTop=6;" vertex="1" parent="1">
          <mxGeometry x="50" y="70" width="420" height="190" as="geometry" />
        </mxCell>
        <mxCell id="12" value="Generic Routing Framework" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;align=left;verticalAlign=top;spacingLeft=8;spacingTop=6;" vertex="1" parent="1">
          <mxGeometry x="500" y="70" width="840" height="560" as="geometry" />
        </mxCell>
        <mxCell id="13" value="Domain Configuration" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontStyle=1;align=left;verticalAlign=top;spacingLeft=8;spacingTop=6;" vertex="1" parent="1">
          <mxGeometry x="1370" y="70" width="360" height="300" as="geometry" />
        </mxCell>
        <mxCell id="14" value="Infrastructure" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontStyle=1;align=left;verticalAlign=top;spacingLeft=8;spacingTop=6;" vertex="1" parent="1">
          <mxGeometry x="970" y="660" width="760" height="250" as="geometry" />
        </mxCell>
        <mxCell id="15" value="Generic Extension Rules" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;align=left;verticalAlign=top;spacingLeft=8;spacingTop=6;" vertex="1" parent="1">
          <mxGeometry x="50" y="660" width="890" height="380" as="geometry" />
        </mxCell>

        <mxCell id="20" value="main.py&#xa;create_app()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="80" y="130" width="160" height="90" as="geometry" />
        </mxCell>
        <mxCell id="21" value="routing/routing.py&#xa;FastAPI assembly + CORS&#xa;include dynamic and auth routers" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="260" y="120" width="190" height="110" as="geometry" />
        </mxCell>

        <mxCell id="22" value="routing/registry.py&#xa;@mongo_entity / @mongo_entity_encrypted&#xa;EntityBinding + get_routers()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="540" y="150" width="260" height="120" as="geometry" />
        </mxCell>
        <mxCell id="23" value="routing/router.py&#xa;GenericCrudRouter&#xa;AuthenticatedCrudRouter&#xa;AuthSessionRouter" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="840" y="150" width="240" height="130" as="geometry" />
        </mxCell>
        <mxCell id="24" value="data/mongo_repository.py&#xa;MongoRepository&#xa;generic CRUD + query helpers" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1120" y="170" width="190" height="100" as="geometry" />
        </mxCell>

        <mxCell id="25" value="data/dto.py&#xa;Pydantic contracts&#xa;decorator metadata for entity routing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1410" y="130" width="290" height="95" as="geometry" />
        </mxCell>
        <mxCell id="26" value="routing/auth_routes.py&#xa;TokenExtension + PasswordExtension&#xa;get_current_user + get_auth_router()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffe6cc;strokeColor=#d79b00;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1410" y="250" width="290" height="95" as="geometry" />
        </mxCell>

        <mxCell id="27" value="Runtime endpoint families&#xa;/auth/* (session)&#xa;/spots/* + /client-errors/* (generic authenticated CRUD)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="540" y="340" width="540" height="110" as="geometry" />
        </mxCell>

        <mxCell id="28" value="MongoDB" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontStyle=1;align=left;verticalAlign=top;spacingLeft=8;spacingTop=6;" vertex="1" parent="1">
          <mxGeometry x="1000" y="700" width="700" height="180" as="geometry" />
        </mxCell>
        <mxCell id="29" value="Auth DB (MONGO_AUTH_DB)&#xa;users" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1040" y="750" width="300" height="90" as="geometry" />
        </mxCell>
        <mxCell id="30" value="App DB (MONGO_DB)&#xa;spots, client_error_reports" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#666666;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="1370" y="750" width="300" height="90" as="geometry" />
        </mxCell>

        <mxCell id="31" value="Rule A: Add entity endpoint without writing a new router&#xa;1) Create Pydantic model in data/dto.py&#xa;2) Add @mongo_entity_encrypted(collection=..., prefix=...)&#xa;3) Startup import registers EntityBinding automatically&#xa;4) GenericCrudRouter exposes POST/GET/PUT/DELETE routes" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ede7f6;strokeColor=#9673a6;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="80" y="720" width="820" height="130" as="geometry" />
        </mxCell>
        <mxCell id="32" value="Rule B: Reuse auth/session framework&#xa;AuthSessionRouter handles register/login by model + extensions,&#xa;while AuthenticatedCrudRouter applies Depends(get_current_user)&#xa;for every protected generic entity route." style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ede7f6;strokeColor=#9673a6;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="80" y="880" width="820" height="130" as="geometry" />
        </mxCell>

        <mxCell id="100" value="bootstraps" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;strokeColor=#666666;" edge="1" parent="1" source="20" target="21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="101" value="include get_routers()" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;strokeColor=#666666;" edge="1" parent="1" source="21" target="22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="102" value="include get_auth_router()" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;strokeColor=#666666;" edge="1" parent="1" source="21" target="26">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="103" value="decorator registration" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;strokeColor=#666666;" edge="1" parent="1" source="25" target="22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="104" value="build router objects" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;strokeColor=#666666;" edge="1" parent="1" source="22" target="23">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="105" value="auth session router" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;strokeColor=#666666;" edge="1" parent="1" source="26" target="23">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="106" value="repository interface" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;strokeColor=#666666;" edge="1" parent="1" source="23" target="24">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="107" value="users" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;strokeColor=#666666;" edge="1" parent="1" source="24" target="29">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="108" value="spots/client-errors" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;strokeColor=#666666;" edge="1" parent="1" source="24" target="30">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="109" value="auth lookup + indexes" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;strokeColor=#666666;" edge="1" parent="1" source="26" target="29">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="110" value="route handlers" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;strokeColor=#666666;" edge="1" parent="1" source="23" target="27">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="111" value="served by FastAPI" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;strokeColor=#666666;" edge="1" parent="1" source="21" target="27">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="112" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=open;dashed=1;strokeColor=#9673a6;" edge="1" parent="1" source="31" target="25">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="113" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=open;dashed=1;strokeColor=#9673a6;" edge="1" parent="1" source="31" target="22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="114" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=open;dashed=1;strokeColor=#9673a6;" edge="1" parent="1" source="32" target="23">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="115" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=open;dashed=1;strokeColor=#9673a6;" edge="1" parent="1" source="32" target="26">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
